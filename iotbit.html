<script>
  const channelId = 3160844;
  const fields = [1, 2, 3];

  async function fetchLastEntry() {
    const url = `https://api.thingspeak.com/channels/${channelId}/feeds/last.json`;
    const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}&t=${Date.now()}`;
    const response = await fetch(proxy);
    if (!response.ok) throw new Error('HTTP ' + response.status);
    return await response.json();
  }

  function render(entry) {
    const container = document.getElementById('values');
    container.innerHTML = '';
    fields.forEach(f => {
      const value = entry[`field${f}`] ?? 'â€”';
      const div = document.createElement('div');
      div.className = 'stat';
      div.innerHTML = `<div class='stat-label'>Field ${f}</div><div class='stat-value'>${value}</div>`;
      container.appendChild(div);
    });
    document.getElementById('timestamp').textContent =
      'Hora: ' + new Date(entry.created_at).toLocaleString();
  }

  async function update() {
    try {
      const last = await fetchLastEntry();
      render(last);
    } catch (err) {
      document.getElementById('timestamp').textContent =
        'Error al obtener datos: ' + err.message;
    }
  }

  update();
  setInterval(update, 60000);
</script>
